# GEMINI.md - 项目上下文

## 项目概述

本项目是一个功能强大的 **MCP (Model Context Protocol) 服务器**，旨在为大型语言模型（LLM）应用提供一套安全、全面的本地系统交互能力。它通过 MCP 协议暴露了一系列工具，允许模型执行文件操作、命令执行、任务管理等多种任务。

服务器采用 Node.js 构建，具有模块化的架构，每个核心功能（如文件操作、文件搜索、命令执行等）都被封装为一个独立的“工具”模块。所有工具都经过一个中央安全验证器，以确保操作的安全性，例如限制文件系统访问和过滤危险命令。

### 主要技术栈

*   **后端：** Node.js
*   **协议：** Model Context Protocol (MCP)
*   **依赖管理：** npm
*   **核心库：** `@modelcontextprotocol/sdk`

## 功能特性

该服务器提供了一套丰富的工具集，主要包括：

*   **文件系统操作：** 安全地读取、写入、列出、创建和删除文件/目录。
*   **行级文件编辑：** 对文件内容进行精确的增、删、改、查操作。
*   **内容搜索：** 在指定路径下按模式（支持正则）搜索文件内容。
*   **文件对比与哈希：** 比较文件差异，计算文件哈希以验证完整性。
*   **权限与压缩：** 管理文件权限，对文件或目录进行压缩和解压。
*   **命令执行：** 在受控环境中执行 shell 命令，并内置危险命令过滤机制。
*   **任务管理：** 为模型提供独立的任务创建、跟踪和管理能力。
*   **环境记忆：** 允许模型存储和检索会话间的环境变量信息。
*   **时间工具：** 提供标准化的时间获取功能。

## 构建与运行

### 环境要求

*   Node.js >= 18.0.0
*   npm

### 安装依赖

在项目根目录下执行以下命令：

```bash
npm install
```

### 启动服务器

可以通过以下任一命令启动 MCP 服务器：

```bash
npm start
```

或者

```bash
npm run dev
```

该项目也可以作为命令行工具全局安装或通过 `npx` 直接运行，`package.json` 中的 `bin` 字段定义了 `local-file-operation-mcp` 命令。

## 项目结构与开发约定

项目遵循模块化的结构，代码逻辑清晰地分离在不同的目录中。

*   `index.js`: 服务器的主入口文件，负责初始化 MCP 服务器并加载所有工具。
*   `bin/cli.js`: 将项目作为命令行工具执行的入口脚本。
*   `tools/`: 存放所有可用工具的目录。
    *   `registry.js`: 工具注册中心，负责实例化所有工具并提供它们的描述符。
    *   `securityValidator.js`: 安全验证模块，提供路径限制和命令过滤等功能。
    *   每个工具对应一个单独的文件（如 `fileOperation.js`, `commandExecution.js`），封装了其具体实现。
*   `lib/`: 存放共享的库代码。
    *   `commandPolicy.js`: 定义了命令执行的安全策略（允许、警告、拒绝）。
*   `package.json`: 定义了项目依赖、脚本和元数据。

### 开发约定

*   **模块化：** 新功能应作为独立的工具模块在 `tools/` 目录下创建。
*   **中心化注册：** 新工具必须在 `tools/registry.js` 中进行注册和描述，以便服务器能够发现和调用。
*   **安全优先：** 所有与文件系统或命令执行相关的操作都必须通过 `securityValidator` 进行校验，以防止不安全的操作。
*   **统一输出：** 工具的输出格式应保持一致，`README.md` 中描述了 `text` 和 `json` 两种主要输出格式。
